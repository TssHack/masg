const { Telegraf, Markup } = require('telegraf');
const express = require('express');
const axios = require('axios'); // Ø§Ú¯Ø± Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø§Ø² API ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯

// --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ ---
const BOT_TOKEN = '8192862567:AAHEEYiXZNW9kIn5B-uZZnNK5S0iqJABod4'; // ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
const ADMIN_CHAT_IDS = [7094106651, 1848591768]; // Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
const WEBHOOK_URL = 'https://nexzo-art.vercel.app/webhook'; // Ø¢Ø¯Ø±Ø³ ÙˆØ¨â€ŒÙ‡ÙˆÚ© Ø´Ù…Ø§ (Ø¨Ø§ÛŒØ¯ HTTPS Ø¨Ø§Ø´Ø¯)
const PORT = process.env.PORT || 3000;

if (!BOT_TOKEN) {
    console.error('Ø®Ø·Ø§: ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§ Ù…ØªØºÛŒØ± BOT_TOKEN Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú©Ù†ÛŒØ¯.');
    process.exit(1);
}
if (ADMIN_CHAT_IDS.length === 0) {
    console.warn('Ù‡Ø´Ø¯Ø§Ø±: Ù‡ÛŒÚ† Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ú©Ø§Ø± Ù†Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯.');
}
if (!WEBHOOK_URL.startsWith('https://')) {
    console.error('Ø®Ø·Ø§: Ø¢Ø¯Ø±Ø³ ÙˆØ¨â€ŒÙ‡ÙˆÚ© Ø¨Ø§ÛŒØ¯ Ø¨Ø§ https Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯.');
    process.exit(1);
}

const bot = new Telegraf(BOT_TOKEN);
const app = express();

// --- Middleware Ø¨Ø±Ø§ÛŒè§£æž JSON ---
app.use(express.json());

// --- Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† ---
// Ø¯Ø± ÛŒÚ© Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø¨Ù‡ØªØ± Ø§Ø³Øª Ø§Ø² ÛŒÚ© Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (Ù…Ø§Ù†Ù†Ø¯ Redis ÛŒØ§ PostgreSQL) Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ù†Ø¸ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯.
// Ø§ÛŒÙ† ÛŒÚ© Ø±Ø§Ù‡â€ŒØ­Ù„ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§Ø³Øª.
const userMessagesForAdmins = new Map(); // Key: message_id_in_admin_chat, Value: original_user_chat_id

// --- ØªÙ†Ø¸ÛŒÙ… Webhook ---
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø±Ø§ ÛŒÚ© Ø¨Ø§Ø± Ù¾Ø³ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø¨ÙˆØ¯Ù† WEBHOOK_URL Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯.
// ÛŒØ§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ù¾Ø³ Ø§Ø² Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù† Ø³Ø±ÙˆØ±)
const setWebhook = async () => {
    try {
        const response = await axios.get(`https://api.telegram.org/bot${BOT_TOKEN}/setWebhook?url=${WEBHOOK_URL}`);
        if (response.data.ok) {
            console.log('Webhook Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯:', response.data.description);
        } else {
            console.error('Ø®Ø·Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ… Webhook:', response.data.description);
        }
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÙ†Ø¸ÛŒÙ… Webhook:', error.message);
    }
};

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙˆØ± /start ---
bot.start(async (ctx) => {
    const firstName = ctx.from.first_name || '';
    const lastName = ctx.from.last_name || '';
    const username = ctx.from.username ? `@${ctx.from.username}` : 'Ù†Ø¯Ø§Ø±Ø¯';
    const userId = ctx.from.id;

    const welcomeMessage = `Ø³Ù„Ø§Ù… ${firstName} ${lastName}! ðŸ‘‹\nÙ¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.`;
    await ctx.reply(welcomeMessage);

    // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ÛŒ Ø±Ø¨Ø§Øª Ø±Ø§ Ø§Ø³ØªØ§Ø±Øª Ø²Ø¯Ù‡ Ø§Ø³Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
    const adminNotification = `Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø±Ø¨Ø§Øª Ø±Ø§ Ø§Ø³ØªØ§Ø±Øª Ø²Ø¯:\n\nÙ†Ø§Ù…: ${firstName} ${lastName}\nÛŒÙˆØ²Ø±Ù†ÛŒÙ…: ${username}\nØ¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ: ${userId}`;
    ADMIN_CHAT_IDS.forEach(adminId => {
        bot.telegram.sendMessage(adminId, adminNotification).catch(err => console.error(`Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† ${adminId}:`, err));
    });
});

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ---
bot.on('text', async (ctx) => {
    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ø² Ø·Ø±Ù Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
    if (ADMIN_CHAT_IDS.includes(ctx.message.from.id) && ctx.message.reply_to_message) {
        // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª Ùˆ Ø¯Ø± Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯
        return;
    }

    const userMessage = ctx.message.text;
    const firstName = ctx.from.first_name || '';
    const lastName = ctx.from.last_name || '';
    const username = ctx.from.username ? `@${ctx.from.username}` : 'Ù†Ø¯Ø§Ø±Ø¯';
    const userId = ctx.from.id;

    const messageToAdmin = `Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ú©Ø§Ø±Ø¨Ø±:\n\nðŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** ${firstName} ${lastName}\nðŸ†” **Ø¢ÛŒØ¯ÛŒ:** \`${userId}\`\nðŸ’¬ **ÛŒÙˆØ²Ø±Ù†ÛŒÙ…:** ${username}\n\nðŸ“ **Ù…ØªÙ† Ù¾ÛŒØ§Ù…:**\n${userMessage}`;

    // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù‡Ù…Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    for (const adminId of ADMIN_CHAT_IDS) {
        try {
            const sentMessage = await bot.telegram.sendMessage(adminId, messageToAdmin, {
                parse_mode: 'Markdown',
                reply_markup: Markup.inlineKeyboard([
                    Markup.button.callback('Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±', `reply_to_${userId}_${ctx.message.message_id}`)
                ]).reply_markup
            });
            // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ø§Ù…Ú©Ø§Ù† Ù¾Ø§Ø³Ø® Ø§Ø² Ø·Ø±Ù Ø§Ø¯Ù…ÛŒÙ†
            // Ú©Ù„ÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ§Ù… Ø¯Ø± Ú†Øª Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´Ø¯ ØªØ§ Ø¨ØªÙˆØ§Ù† Ù¾Ø§Ø³Ø® Ø±Ø§ Ø¨Ù‡ Ø¢Ù† Ù…Ø±ØªØ¨Ø· Ú©Ø±Ø¯
            // Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ§Ù… Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (Ú©Ù‡ Ø´Ø§ÛŒØ¯ Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´ Ù†Ø¨Ø§Ø´Ø¯)
            // Ø¨Ù‡ØªØ± Ø§Ø³Øª ÛŒÚ© Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± "Ù…ÙˆØ±Ø¯" (ØªÛŒÚ©Øª) Ø§ÛŒØ¬Ø§Ø¯ Ø´ÙˆØ¯.
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ØŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ù¾ÛŒØ§Ù… ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯.
        } catch (error) {
            console.error(`Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† ${adminId}:`, error);
            // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø·Ù„Ø§Ø¹ Ø¯Ù‡ÛŒØ¯ Ú©Ù‡ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯Ù‡ Ø§Ø³Øª
            // ctx.reply('Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§ Ø¨Ø¹Ø¯Ø§ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
        }
    }

    await ctx.reply('Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù…Ù†ØªØ¸Ø± Ù¾Ø§Ø³Ø® Ø¨Ù…Ø§Ù†ÛŒØ¯.');
});

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ ---
// Ø§ÛŒÙ† Ø¨Ø®Ø´ Ú©Ù…ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ± Ø§Ø³Øª Ø²ÛŒØ±Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ø¯Ø§Ù†ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ú©Ø¯Ø§Ù… Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.
// ÛŒÚ© Ø±Ø§Ù‡ Ø±Ø§ÛŒØ¬ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ú©Ù…Ù‡ inline Ùˆ callback query Ø§Ø³Øª.
// Ø±ÙˆØ´ Ø¯ÛŒÚ¯Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ù¾ÛŒØ§Ù… ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± "Reply" Ú©Ù†Ø¯.

bot.on('message', async (ctx) => {
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù¾ÛŒØ§Ù… Ø§Ø² Ø·Ø±Ù ÛŒÚ©ÛŒ Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ø³Øª
    if (!ADMIN_CHAT_IDS.includes(ctx.message.from.id)) {
        return; // Ù¾ÛŒØ§Ù… Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ Ø§Ø³Øª Ùˆ Ø¯Ø± Ø¨Ø®Ø´ Ù‚Ø¨Ù„ÛŒ (bot.on('text')) Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡
    }

    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø± Ø­Ø§Ù„ "Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù†" (Reply) Ø¨Ù‡ Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø³Øª
    if (ctx.message.reply_to_message) {
        const repliedToMessage = ctx.message.reply_to_message;
        const adminReplyText = ctx.message.text; // Ù¾ÛŒØ§Ù… Ø§Ø¯Ù…ÛŒÙ†

        // Ø­Ø§Ù„Ø§ Ø¨Ø§ÛŒØ¯ Ø¨ÙÙ‡Ù…ÛŒÙ… Ø§ÛŒÙ† Ù¾ÛŒØ§Ù…ÛŒ Ú©Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ø¢Ù† Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ø±Ø¯Ù‡ØŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ú©Ø¯Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª.
        // Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ù…Ù†Ø·Ù‚ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ÛŒ Ø§Ø³Øª.
        // Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ùˆ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ø¢Ù† Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ
        // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ø§Ø² `repliedToMessage.forward_from` Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø§ØµÙ„ÛŒ Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†ÛŒÙ….

        let originalUserId;
        let originalUserFirstName = 'Ú©Ø§Ø±Ø¨Ø±';

        // Ø³Ù†Ø§Ø±ÛŒÙˆ Û±: Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ù¾ÛŒØ§Ù…ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ø±Ø¯Ù‡ Ú©Ù‡ Ø­Ø§ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ù…ØªÙ† Ø¢Ù† Ø§Ø³Øª (Ú©Ù‡ Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯ÛŒÙ…)
        if (repliedToMessage.text && repliedToMessage.text.includes('ðŸ†” **Ø¢ÛŒØ¯ÛŒ:** `')) {
            const match = repliedToMessage.text.match(/ðŸ†” \*\*Ø¢ÛŒØ¯ÛŒ:\*\* `(\d+)`/);
            if (match && match[1]) {
                originalUserId = parseInt(match[1], 10);
            }
            const nameMatch = repliedToMessage.text.match(/ðŸ‘¤ \*\*Ú©Ø§Ø±Ø¨Ø±:\*\* (.*?)\n/);
            if (nameMatch && nameMatch[1]) {
                originalUserFirstName = nameMatch[1];
            }
        }
        // Ø³Ù†Ø§Ø±ÛŒÙˆ Û² (Ø¨Ù‡ØªØ±): Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± ØªÙˆØ³Ø· Ø±Ø¨Ø§Øª)
        else if (repliedToMessage.forward_from) {
            originalUserId = repliedToMessage.forward_from.id;
            originalUserFirstName = repliedToMessage.forward_from.first_name || 'Ú©Ø§Ø±Ø¨Ø±';
        }
        // Ø³Ù†Ø§Ø±ÛŒÙˆ Û³: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Callback Query (Ú©Ù‡ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡ ÙˆÙ„ÛŒ Ø±ÙˆØ´ Ø¨Ù‡ØªØ±ÛŒ Ø§Ø³Øª)
        // Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„ØªØŒ Ø§Ø² userMessagesForAdmins Ú©Ù‡ Ù‚Ø¨Ù„Ø§ ØªØ¹Ø±ÛŒÙ Ø´Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
        // ÙØ±Ø¶ Ú©Ù†ÛŒÙ… Ú©Ù„ÛŒØ¯ MapØŒ Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¯Ú©Ù…Ù‡ "Ù¾Ø§Ø³Ø®" Ø²ÛŒØ± Ø¢Ù† Ø¨ÙˆØ¯Ù‡.
        // const originalUserInfo = userMessagesForAdmins.get(repliedToMessage.message_id);
        // if (originalUserInfo) {
        //     originalUserId = originalUserInfo.userId;
        //     originalUserFirstName = originalUserInfo.firstName;
        // }

        if (originalUserId && adminReplyText) {
            try {
                await bot.telegram.sendMessage(originalUserId, `Ù¾Ø§Ø³Ø® Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†:\n\n${adminReplyText}`);
                await ctx.reply('Ù¾Ø§Ø³Ø® Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.');
                console.log(`Ù¾Ø§Ø³Ø® Ø§Ø² Ø§Ø¯Ù…ÛŒÙ† ${ctx.message.from.id} Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± ${originalUserId} Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.`);
            } catch (error) {
                console.error(`Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± ${originalUserId}:`, error);
                await ctx.reply('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±. Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ù„Ø§Ú¯ Ø³Ø±ÙˆØ± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª.');
            }
        } else if (adminReplyText) { // Ø§Ú¯Ø± Ø§Ø¯Ù…ÛŒÙ† Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯Ù‡ Ú©Ù‡ Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ù†ÛŒØ³Øª ÛŒØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯
            // Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÛŒÚ© Ù¾ÛŒØ§Ù… Ø¹Ø§Ø¯ÛŒ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯.
            // ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹ Ø¯Ù‡ÛŒÙ… Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø¨Ø§ÛŒØ¯ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Reply Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯.
            // console.log('Ù¾ÛŒØ§Ù… Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø¯ÙˆÙ† Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ù…Ø´Ø®Øµ ÛŒØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯.');
            // await ctx.reply('Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ØŒ Ù„Ø·ÙØ§ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± "Reply" Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.');
        }
    } else if (ADMIN_CHAT_IDS.includes(ctx.message.from.id) && ctx.message.text && !ctx.message.text.startsWith('/')) {
        // Ø§Ú¯Ø± Ø§Ø¯Ù…ÛŒÙ† Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯ Ú©Ù‡ Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ù†ÛŒØ³Øª Ùˆ Ø¯Ø³ØªÙˆØ± Ù‡Ù… Ù†ÛŒØ³ØªØŒ Ø¨Ù‡ Ø§Ùˆ ØªØ°Ú©Ø± Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.
        // ctx.reply('Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ØŒ Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø² Ø·Ø±Ù Ú©Ø§Ø±Ø¨Ø± "Reply" Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…Ø±Ø¨ÙˆØ·Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…Ø§ÛŒÛŒØ¯.');
    }
});


// --- Ù…Ø¯ÛŒØ±ÛŒØª Callback Query Ù‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ "Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±") ---
// Ø§ÛŒÙ† ÛŒÚ© Ø±ÙˆØ´ Ø¨Ù‡ØªØ± Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª.
bot.action(/reply_to_(\d+)_(\d+)/, async (ctx) => {
    const targetUserId = parseInt(ctx.match[1], 10);
    const originalUserMessageId = parseInt(ctx.match[2], 10); // Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒØ§Ù… Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø¬Ø§Ø¹)

    const adminId = ctx.from.id;

    // Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ù¾ÛŒØ§Ù… Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… Ú©Ù‡ Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†Ø¯.
    // Ùˆ Ø§ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ù†Ø­ÙˆÛŒ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ù…Ø±ØªØ¨Ø· Ø´ÙˆØ¯.
    // ÛŒÚ© Ø±Ø§Ù‡ Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø§Ø² Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø®ÙˆØ§Ù‡ÛŒÙ… Ø¯Ø± Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ÛŒ Ø®ÙˆØ¯ Ù¾Ø§Ø³Ø® Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†Ø¯.
    // Ùˆ Ù…Ø§ Ù…Ù†ØªØ¸Ø± Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ÛŒ Ø§Ø² Ø§ÛŒÙ† Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§Ø´ÛŒÙ….

    // Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª: Ø§Ø¯Ù…ÛŒÙ† X Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Y Ù¾Ø§Ø³Ø® Ø¯Ù‡Ø¯.
    // Ø§ÛŒÙ† Ø±ÙˆØ´ Ø³Ø§Ø¯Ù‡ Ø§Ø³Øª Ùˆ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ù‡ Ú†Ù†Ø¯ Ù†ÙØ± Ø¨Ø®ÙˆØ§Ù‡Ø¯ Ù¾Ø§Ø³Ø® Ø¯Ù‡Ø¯ØŒ Ø¯Ú†Ø§Ø± Ù…Ø´Ú©Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    // Ø±Ø§Ù‡ Ø­Ù„ Ø¨Ù‡ØªØ±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Telegraf Scenes ÛŒØ§ ÛŒÚ© state manager Ø®Ø§Ø±Ø¬ÛŒ.
    // For simplicity, we'll just inform the admin.
    // A more robust solution would involve scenes or a dedicated state management.

    await ctx.answerCbQuery('Ø¯Ø± Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ÛŒØŒ Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.');
    await ctx.reply(`Ù„Ø·ÙØ§ Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ \`${targetUserId}\` (Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù¾ÛŒØ§Ù… Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${originalUserMessageId}) Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯. Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§ Ø¨Ù‡ Ø§Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`);

    // ØªÙ†Ø¸ÛŒÙ… ÛŒÚ© Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ÛŒ Ø§ÛŒÙ† Ø§Ø¯Ù…ÛŒÙ†
    // Ø§ÛŒÙ† Ø±ÙˆØ´ Ø³Ø§Ø¯Ù‡ Ø§Ø³Øª Ùˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø§Ø±Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ú¯Ø± Ø§Ø¯Ù…ÛŒÙ† Ù¾ÛŒØ§Ù… Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨ÙØ±Ø³ØªØ¯)
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `bot.hears` ÛŒØ§ `bot.on('text')` Ø¨Ø§ ÛŒÚ© ÙÙ„Ú¯ ÛŒØ§ ÙˆØ¶Ø¹ÛŒØª Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ØªØ± Ø§Ø³Øª.

    // ÛŒÚ© Ø±Ø§Ù‡â€ŒØ­Ù„ Ø³Ø§Ø¯Ù‡â€ŒØªØ±: Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ù¾ÛŒØ§Ù…ÛŒ Ú©Ù‡ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø¢Ù† Ø¨ÙˆØ¯Ù‡ "Reply" Ú©Ù†Ø¯.
    // Ùˆ Ù…Ø§ Ø¯Ø± `bot.on('message')` Ø¢Ù† Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒÙ….
    // Ø§ÛŒÙ† Ø¯Ú©Ù…Ù‡ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø± Ùˆ Ù¾ÛŒØ§Ù… Ø§Ø³Øª.

    // Ø¯Ø± Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ¹Ù„ÛŒ `bot.on('message')`ØŒ Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ù¾ÛŒØ§Ù… Ø§ØµÙ„ÛŒ Ø±Ø¨Ø§Øª (Ú©Ù‡ Ø­Ø§ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª) reply Ú©Ù†Ø¯.
    // Ø§ÛŒÙ† Ø¯Ú©Ù…Ù‡ callback Ø¨ÛŒØ´ØªØ± Ø¬Ù†Ø¨Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯.
});


// --- Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ Telegraf ---
bot.catch((err, ctx) => {
    console.error(`Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¢Ù¾Ø¯ÛŒØª ${ctx.updateType}:`, err);
    // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ùˆ Ø¨Ø§ Ø§Ø­ØªÛŒØ§Ø· Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ù„Ù‚Ù‡ Ø®Ø·Ø§)
    const errorMessage = `Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ ÛŒÚ© Ø®Ø·Ø§ Ø¯Ø± Ø±Ø¨Ø§Øª Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª:\n\`${err.message}\`\n\nUpdate Type: ${ctx.updateType}\nUpdate: \`${JSON.stringify(ctx.update, null, 2)}\``;
    ADMIN_CHAT_IDS.forEach(adminId => {
        // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø®ÛŒÙ„ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ù†Ø¨Ø§Ø´Ø¯
        bot.telegram.sendMessage(adminId, errorMessage.substring(0, 4090)).catch(e => console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†:", e));
    });
});


// --- Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ± Express Ø¨Ø±Ø§ÛŒ Webhook ---
// Ù…Ø³ÛŒØ± Webhook Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø¢Ù†Ú†Ù‡ Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ ÛŒÚ©ÛŒ Ø¨Ø§Ø´Ø¯.
app.use(bot.webhookCallback('/webhook')); // telegraf middleware

// --- Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± ---
app.listen(PORT, async () => {
    console.log(`Ø³Ø±ÙˆØ± Ø¯Ø± Ù¾ÙˆØ±Øª ${PORT} Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª...`);
    console.log(`Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… WebhookØŒ Ø¢Ø¯Ø±Ø³ Ø²ÛŒØ± Ø±Ø§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ø¯Ù‡ÛŒØ¯ (ÛŒÚ© Ø¨Ø§Ø± Ú©Ø§ÙÛŒ Ø§Ø³Øª):`);
    console.log(`${WEBHOOK_URL}`);
    console.log(`Ø¨Ø±Ø§ÛŒ ØªØ³ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¯Ø³ØªÙˆØ± Ø²ÛŒØ± Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± ÛŒØ§ ØªØ±Ù…ÛŒÙ†Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (Ù¾Ø³ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ ngrok Ø§Ú¯Ø± Ù„ÙˆÚ©Ø§Ù„ Ù‡Ø³ØªÛŒØ¯):`);
    console.log(`curl "https://api.telegram.org/bot${BOT_TOKEN}/setWebhook?url=${WEBHOOK_URL}"`);

    // --- ØªÙ†Ø¸ÛŒÙ… Webhook Ù¾Ø³ Ø§Ø² Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ± ---
    // Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± ÛŒØ§ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ URL ÙˆØ¨â€ŒÙ‡ÙˆÚ© ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.
    // Ø¯Ø± Ù…Ø­ÛŒØ· Ù¾Ø±ÙˆØ¯Ø§Ú©Ø´Ù†ØŒ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ ÛŒØ§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¯ÛŒÚ¯Ø±ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯.
    if (process.env.NODE_ENV === 'production' || process.env.SET_WEBHOOK_ON_START) { // ÙÙ‚Ø· Ø¯Ø± Ù¾Ø±ÙˆØ¯Ø§Ú©Ø´Ù† ÛŒØ§ Ø¨Ø§ ÙÙ„Ú¯ Ø®Ø§Øµ
         await setWebhook();
    } else {
         console.warn("ØªÙˆØ¬Ù‡: Webhook Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯. Ø§Ú¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ø¨Ø§Ø± Ø§Ø³Øª ÛŒØ§ URL ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ØŒ Ø¢Ù† Ø±Ø§ Ø¯Ø³ØªÛŒ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.");
         console.warn(`Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ URL Ø²ÛŒØ± Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² cURL Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:`);
         console.warn(`https://api.telegram.org/bot${BOT_TOKEN}/setWebhook?url=${WEBHOOK_URL}&drop_pending_updates=true`);
    }
});

// --- Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯Ù† Ø¯Ø±Ø³Øª Ø±Ø¨Ø§Øª ---
process.once('SIGINT', () => {
    console.log("Ø¯Ø± Ø­Ø§Ù„ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø±Ø¨Ø§Øª (SIGINT)...");
    bot.stop('SIGINT');
    // Ø§Ú¯Ø± Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÛŒØ§ Ù…Ù†Ø§Ø¨Ø¹ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯.
    process.exit(0);
});
process.once('SIGTERM', () => {
    console.log("Ø¯Ø± Ø­Ø§Ù„ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø±Ø¨Ø§Øª (SIGTERM)...");
    bot.stop('SIGTERM');
    process.exit(0);
});
